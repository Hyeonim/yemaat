<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{userPage/Layout_userPage2}">


<th:block th:fragment="content">

    <style>

        .mypage_sidebar_nav {
            color: gray;
        }

        #reviewSelect {
            font-weight: bold;
            color: black;
            border-bottom: 2px solid black;
        }

        .rate_radio {
            z-index: 20;
            opacity: 1;
            width: 60px;
            height: 60px;
            background-color: #a19f9f;
            cursor: pointer;
            position: absolute;
            left: -999px;
        }

        .rate_radio + label {
            /*border: 0.5px solid gray;*/
            position: relative;
            display: block;
            float: left;
            z-index: 10;
            width: 59px;
            height: 60px;
            background-image: url("/img/starrate.png");
            background-repeat: no-repeat;
            background-size: 60px 60px;
            cursor: pointer;
        }

        .rating .ratefillYellow {
            background-color: #ff8;
            height: 60px;
            position: absolute;
            width: 60px; /* 초기에는 0으로 설정 */
            transition: width 0.3s; /* 너비가 변경될 때 애니메이션을 추가합니다. */
            z-index: 9;
        }

        .rating .ratefillGray {
            position: absolute;
            background-color: gray;
            height: 60px;
            width: 295px;
            z-index: 1;
        }

        /*!* 홀수번째 요소 선택 *!*/
        /*.posts_main .containers:nth-child(odd) {*/
        /*    transform: translateX(24%); !* X축으로 50% 이동 *!*/
        /*}*/

        /*!* 짝수번째 요소 선택 *!*/
        /*.posts_main .containers:nth-child(even) {*/
        /*    transform: translateX(-24%); !* X축으로 50% 이동 *!*/

        /*}*/

        #remote {
            border: 1px solid gray;
            width: 320px;
            height: 400px;
            transition: margin-top 0.8s ease; /* 부드러운 이동을 위한 트랜지션 추가 */
        }

        .RestNoHover:hover {
            font-size: 105%;
            color: #282828;
        }
    </style>

    <div style="display: flex; justify-content: center; margin-top: -132px">
        <div style="display: flex; justify-content: center; background-color: #FFFFFF; width: 1231px; height: 774px; border-radius: 0px; padding: 2% ">
            <div class="mid" style="display: flex; justify-content: center">
                <div style="padding: 33px">
                    <div style="display: flex; justify-content: flex-start; flex-direction: column; margin-right: 1px; height: 412px">
                        <input type="hidden" name="rate" id="rate" value="0"/>
                        <p class="title_star">별점과 이용경험을 남겨주세요.</p>

                        <form id="addRevForm" th:action="@{/user/updateReview/{revNo}(revNo=${review.get().id})}"
                              method="post"
                              enctype="multipart/form-data">
                            <div style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                <div>
                                    <label for="file">이미지:</label><br>
                                    <img style="width: 200px; height: 180px; border: 1.6px solid #dddddd; background-size: cover;"
                                         id="preview" th:src="'data:image/jpeg;base64,' + ${review.get().base64Image}"
                                         alt="">
                                    <br>
                                    <input type="file" id="file" name="file" onchange="previewImage(this);">
                                </div>
                                <input hidden="hidden" name="revNo" th:value="${review.get().id}">
                                <input hidden="hidden" name="userNo" th:value="${review.get().getUserNo().userNo}">
                                <input hidden="hidden" name="restNo" th:value="${review.get().getRestNo().restNo}">
                                <input hidden="hidden" name="resNo" th:value="${review.get().getResNo().res_no}">
                                <input hidden="hidden" name="revWriteTime" th:value="${review.get().revWriteTime}">

                                <div class="rating">
                                    <div class="ratefillGray"></div>
                                    <div class="ratefillYellow"></div>
                                    <input type="radio" name="revScore" id="rating1" value="10" class="rate_radio"
                                           title="1점" th:checked="${review.get().revScore == 1.0}">
                                    <label class="rate_label" for="rating1"></label>

                                    <input type="radio" name="revScore" id="rating2" value="20" class="rate_radio"
                                           title="2점" th:checked="${review.get().revScore == 2.0}">
                                    <label class="rate_label" for="rating2"></label>

                                    <input type="radio" name="revScore" id="rating3" value="30" class="rate_radio"
                                           title="3점" th:checked="${review.get().revScore == 3.0}">
                                    <label class="rate_label" for="rating3"></label>

                                    <input type="radio" name="revScore" id="rating4" value="40" class="rate_radio"
                                           title="4점" th:checked="${review.get().revScore == 4.0}">
                                    <label class="rate_label" for="rating4"></label>

                                    <input type="radio" name="revScore" id="rating5" value="50" class="rate_radio"
                                           title="5점" th:checked="${review.get().revScore == 5.0}">
                                    <label class="rate_label" for="rating5"></label>
                                    <br>

                                </div>
                                <br>
                            </div>
                            <hr>

                            <div style="margin-top: 53px">
                                <label>식당 이름:</label>
                                <div th:text="${review.get().getRestNo().restName}"></div>
                                <!--                        <input th:if="${not #strings.isEmpty(review.get().resNo)}" th:value="${review.get().resNo}"-->
                                <!--                               name="resNo" th:hidden="true"/>-->
                                <!--                        <input th:value="${review.get().getResNo().res}" name="restNo"/>-->
                            </div>
                            <hr>
                            <div style="margin-top: 30px">
                            <textarea id="reviewContent" th:text="${review.get().revContent}" name="revContent" rows="5"
                                      cols="82" style="resize: none;"></textarea>
                            </div>
                            <button id="revAdd" class="reviewAddBtn" type="submit"
                                    style="margin-top: 21px; position: relative; left: -37px; width: 114%;">리뷰 제출
                            </button>
                        </form>

                        <input style="opacity: 0" type="text" id="RevScore" name="RevScore"
                               th:value="${review.get().revScore}"><br>
                        <input style="opacity: 0" type="text" id="selectedRevScore" name="selectedRevScore" value="">
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        function previewImage(input) {
            var preview = document.getElementById('preview');

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

        document.getElementById('file').addEventListener('change', function () {
            previewImage(this);
        });

        document.getElementById("revAdd").addEventListener("click", function (event) {
            event.preventDefault();
            var confirmation = confirm("리뷰를 작성하시겠습니까?");
            if (confirmation) {
                document.getElementById("addRevForm").submit();
            } else {
            }
        });

        $(document).ready(function () {

            let initialRevScore = parseInt($('#RevScore').val());
            $('.ratefillYellow').css('width', (initialRevScore * 5.9) * 10 + 'px');

            $('.rate_label').click(function () {
                let ratingValue = $(this).prev().val();
                let mid = $(this).closest('.mid');
                let selectedRevScore = mid.find('#selectedRevScore');
                let fillWidth = ratingValue * 5.9;

                mid.find('.ratefillYellow').css('width', fillWidth + 'px');
                selectedRevScore.val(fillWidth);

            });
        });


    </script>
</th:block>
</html>